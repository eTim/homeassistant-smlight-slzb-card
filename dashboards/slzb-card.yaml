type: custom:config-template-card
entities:
  - sensor.slzb_mr4u_zigbee_type
  - sensor.slzb_mr4u_zigbee_type_2
card:
  type: custom:stack-in-card
  cards:
    - type: custom:mushroom-template-card
      primary: SLZB-MR4U
      secondary: >
        mode: {{ states('sensor.slzb_mr4u_connection_mode') }} |  {{ 'Internet
        OK' if is_state('binary_sensor.slzb_mr4u_internet', 'on') else 'Local'
        }}
      icon: mdi:router-wireless
      icon_color: >
        {{ 'green' if is_state('binary_sensor.slzb_mr4u_ethernet', 'on') or
        is_state('binary_sensor.slzb_mr4u_wi_fi', 'on') else 'red' }}
      fill_container: true
    - type: custom:mushroom-chips-card
      chips:
        - type: template
          icon: mdi:antenna
          content: "EFR32: {{ states('sensor.slzb_mr4u_zigbee_type') }}"
          icon_color: "#0051FF"
        - type: template
          icon: mdi:antenna
          content: "CC26: {{ states('sensor.slzb_mr4u_zigbee_type_2') }}"
          icon_color: amber
        - type: template
          icon: mdi:clock-outline
          content: >
            {% set uptime = states('sensor.slzb_mr4u_core_uptime') %}  {% if
            uptime not in ['unknown', 'unavailable', 'none'] %}
              {% set delta = now() - as_datetime(uptime) %}
              {{ delta.days }}j {{ (delta.seconds // 3600) }}h
            {% else %} ??? {% endif %}
        - type: template
          icon: mdi:vpn
          content: "VPN: {{states('binary_sensor.slzb_mr4u_vpn')}}"
          icon_color: >-
            {{ 'blue' if is_state('binary_sensor.slzb_mr4u_vpn', 'on') else
            'grey' }}
      alignment: center
    - type: custom:mushroom-title-card
      subtitle: Temperature
    - type: horizontal-stack
      cards:
        - type: custom:mushroom-template-card
          entity: sensor.slzb_mr4u_temperature_de_la_puce_principale
          primary: Core SLZB-MR4U
          secondary: "{{ states(entity) }} °C"
          icon: mdi:thermometer
          icon_color: "#ECFA8E"
          tap_action:
            action: more-info
        - type: custom:mushroom-template-card
          entity: sensor.slzb_mr4u_temperature_de_la_puce_zigbee
          primary: Temp. {{ states('sensor.slzb_mr4u_zigbee_type') }}
          secondary: "{{ states(entity) }} °C"
          icon: mdi:thermometer
          icon_color: "#0051FF"
          tap_action:
            action: more-info
        - type: custom:mushroom-template-card
          entity: sensor.slzb_mr4u_temperature_de_la_puce_zigbee_2
          primary: Temp. {{ states('sensor.slzb_mr4u_zigbee_type_2') }}
          secondary: "{{ states(entity) }} °C"
          icon: mdi:thermometer
          icon_color: "#FFC107"
          tap_action:
            action: more-info
    - type: custom:mini-graph-card
      entities:
        - entity: sensor.slzb_mr4u_temperature_de_la_puce_principale
          name: Core
          color: "#ECFA8E"
        - entity: sensor.slzb_mr4u_temperature_de_la_puce_zigbee
          name: ${states['sensor.slzb_mr4u_zigbee_type'].state}
          color: "#0051FF"
        - entity: sensor.slzb_mr4u_temperature_de_la_puce_zigbee_2
          name: ${states['sensor.slzb_mr4u_zigbee_type_2'].state}
          color: "#FFC107"
      line_width: 2
      height: 60
      hours_to_show: 24
      align_state: left
      show:
        icon: false
        legend: true
        state: false
        name: false
    - type: custom:mushroom-title-card
      subtitle: Memory
    - type: horizontal-stack
      cards:
        - type: custom:mushroom-template-card
          entity: sensor.slzb_mr4u_filesystem_usage
          primary: FileSystem Usage
          secondary: "{{ states('sensor.slzb_mr4u_filesystem_usage') }} kB"
          icon: mdi:harddisk
          icon_color: "#3498db"
          tap_action:
            action: more-info
        - type: custom:mushroom-template-card
          entity: sensor.slzb_mr4u_utilisation_de_la_memoire
          primary: Utilisation Mémoire
          secondary: "{{ states('sensor.slzb_mr4u_utilisation_de_la_memoire') }} kB"
          icon: mdi:database
          icon_color: "#9b59b6"
          tap_action:
            action: more-info
    - type: custom:mini-graph-card
      entities:
        - entity: sensor.slzb_mr4u_filesystem_usage
          name: FileSystem Usage
          color: "#3498db"
        - entity: sensor.slzb_mr4u_utilisation_de_la_memoire
          name: Utilisation Mémoire
          color: "#9b59b6"
      line_width: 2
      height: 40
      hours_to_show: 24
      align_state: left
      show:
        icon: false
        legend: false
        state: false
        name: false
    - type: custom:mushroom-title-card
      subtitle: Action
    - type: conditional
      conditions:
        - entity: update.slzb_mr4u_core_firmware
          state: "on"
      card:
        type: custom:mushroom-update-card
        entity: update.slzb_mr4u_core_firmware
        name: MAJ Système (Core)
        layout: horizontal
        show_buttons_control: true
    - type: conditional
      conditions:
        - entity: update.slzb_mr4u_zigbee_firmware
          state: "on"
      card:
        type: custom:mushroom-update-card
        entity: update.slzb_mr4u_zigbee_firmware
        name: ${'Chip EFR32 (' + states['sensor.slzb_mr4u_zigbee_type'].state + ')'}
        show_buttons_control: true
        layout: horizontal
    - type: conditional
      conditions:
        - entity: update.slzb_mr4u_zigbee_firmware_2
          state: "on"
      card:
        type: custom:mushroom-update-card
        entity: update.slzb_mr4u_zigbee_firmware_2
        name: >-
          ${'MAJ Puce CC26 (' + states['sensor.slzb_mr4u_zigbee_type_2'].state +
          ')'}
        show_buttons_control: true
        layout: horizontal
    - type: horizontal-stack
      cards:
        - type: custom:mushroom-template-card
          primary: SLZB-MR4U
          secondary: Reset
          icon: mdi:cog-refresh
          icon_color: red
          layout: vertical
          tap_action:
            action: call-service
            service: button.press
            target:
              entity_id: button.slzb_mr4u_core_restart
        - type: custom:mushroom-template-card
          primary: Radio
          secondary: Reset
          icon: mdi:wifi-refresh
          icon_color: amber
          layout: vertical
          tap_action:
            action: call-service
            service: button.press
            target:
              entity_id: button.slzb_mr4u_zigbee_restart
        - type: custom:mushroom-template-card
          primary: Flash Mode
          icon: mdi:memory-arrow-down
          icon_color: blue
          layout: vertical
          tap_action:
            action: call-service
            service: button.press
            target:
              entity_id: button.slzb_mr4u_zigbee_flash_mode
        - type: custom:mushroom-template-card
          icon: mdi:web
          primary: Control
          secondary: Panel
          icon_color: blue
          layout: vertical
          tap_action:
            action: url
            url_path: http://slzb-mr4u.local
    - type: horizontal-stack
      cards:
        - type: custom:mushroom-entity-card
          entity: switch.slzb_mr4u_led_night_mode
          name: Nuit
        - type: custom:mushroom-entity-card
          entity: switch.slzb_mr4u_disable_leds
          name: LEDs Off
        - type: custom:mushroom-entity-card
          entity: switch.slzb_mr4u_auto_zigbee_update
          name: Auto-Up
          icon: mdi:refresh-auto
